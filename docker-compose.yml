services:
  wildlings:
    build: .
    ports:
      - '8000:8000'
    volumes:
      - wildlings-data:/data
    environment:
      - DATABASE_URL=sqlite:////data/wildlings.db
      - STATIC_DIR=/app/app/dist
      - CORS_ALLOW_ORIGINS=
      - INTERNAL_SYNC_TOKEN=
    healthcheck:
      test:
        - CMD-SHELL
        - >-
          python -c "import os,urllib.request;req=urllib.request.Request('http://localhost:8000/sync/pull?cursor=',headers={'X-Internal-Token': os.getenv('INTERNAL_SYNC_TOKEN','')});urllib.request.urlopen(req,timeout=2).read()"
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  wildlings-data:
